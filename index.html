<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ØµÙ…Ø©</title>
</head>
<body style="font-family: Tahoma; text-align: center; margin-top: 100px;">

  <h2>Ù…Ø±Ø­Ø¨Ø§ ğŸ‘‹</h2>
  <p id="message" style="color: #c00; font-size: 18px;">
    Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¨ØµÙ…Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¬Ù‡Ø§Ø²Ùƒ
  </p>

  <button onclick="requestFingerprint()" style="padding: 10px 20px; font-size: 18px;">
    ØªÙØ¹ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ØµÙ…Ø© Ø§Ù„Ø¬ÙˆØ§Ù„
  </button>

  <script>
    async function requestFingerprint() {
      try {
        const available = await PublicKeyCredential.isUserVerifyingPlatformAuthenticatorAvailable();
        if (!available) {
          document.getElementById("message").innerText = "ğŸ”’ Ø¬Ù‡Ø§Ø²Ùƒ Ù„Ø§ ÙŠØ¯Ø¹Ù… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø¨ØµÙ…Ø©.";
          return;
        }

        // ÙÙ‚Ø· Ø·Ù„Ø¨ ØªØ­Ù‚Ù‚ ÙˆÙ„ÙŠØ³ ØªØ³Ø¬ÙŠÙ„ Ù…ÙØªØ§Ø­
        const challenge = new Uint8Array(32);
        window.crypto.getRandomValues(challenge);

        const assertion = await navigator.credentials.get({
          publicKey: {
            challenge: challenge,
            timeout: 60000,
            userVerification: 'required',
            allowCredentials: []
          }
        });

        // Ø¥Ø°Ø§ Ù†Ø¬Ø­Øª Ø§Ù„Ø¨ØµÙ…Ø©ØŒ Ø£Ø±Ø³Ù„ Ø¥Ù„Ù‰ n8n
        await fetch("https://osama88.app.n8n.cloud/webhook/fingerprint-test", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            verified: true,
            employeeId: "12345",
            timestamp: new Date().toISOString()
          })
        });

        document.getElementById("message").innerText = "âœ… ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ù†Ø¬Ø§Ø­!";
        document.getElementById("message").style.color = "green";

      } catch (err) {
        console.error("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚:", err);
        document.getElementById("message").innerText = "âŒ ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø¨ØµÙ…Ø©ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø¬Ø¯Ø¯Ù‹Ø§.";
        document.getElementById("message").style.color = "#c00";
      }
    }
  </script>
</body>
</html>
